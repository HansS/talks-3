<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Rudolph</title>
	<style>
		body {
			font-family: Georgia;
		}

		.container {
			margin: 0 auto;
			padding: 0;
			width: 400px;
		}

		.slider {
			width: 100%;
		}
		.sprite {
	    width: 280px;
	    height: 456px;
	    background: url('spritesheet.png');
			margin: 0 auto;
		}
		.value {
			font-style: bold;
			font-size: 2vw;
		}
	</style>
</head>
<body>
	<div class="container">
		<div id="sprite" class="sprite"></div>
		<input type="range" class ="slider" min=0 max=70 value=0/>
		<p id="slider-value" class="value">Slider value: 0</p>
		<p id="resistor-value" class="value">Resistor value: 0 â„¦</p>
	</div>

	<script src="motio.min.js"></script>
	<script>
		window.onload = function(){
			var element = document.querySelector('#sprite');
			var hasStarted = false;
			var sprite = new Motio(element, {
		    fps: 3.5,
		    frames: 7
			});

			var slider = document.querySelector('input');
			var sliderValue = document.getElementById('slider-value')

			slider.value = 0

			var AudioContext = window.AudioContext || window.webkitAudioContext;
			var context = new AudioContext();
			var bufferPlayer = context.createBufferSource();
			bufferPlayer.connect(context.destination);
			var loadXHR = new XMLHttpRequest();
			loadXHR.open('GET', 'audio.wav');
			loadXHR.responseType = 'arraybuffer';
			loadXHR.onload = function(){
				context.decodeAudioData(loadXHR.response, function(decodedAudioBuffer){
					bufferPlayer.buffer = decodedAudioBuffer;
					bufferPlayer.loop = true;
					bufferPlayer.playbackRate.value = 0.5;
					bufferPlayer.loopStart = 1.0;
					bufferPlayer.loopEnd = decodedAudioBuffer.duration;
					if (!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){
						bufferPlayer.start(0,1);
						sprite.play();
						hasStarted = true;
					}else{
						document.body.addEventListener('touchstart', function(){
							if (!hasStarted){
								bufferPlayer.start(0,1);
								sprite.play();
								hasStarted = true;
							}
						});
					}
				})
			};
			loadXHR.send();

			slider.addEventListener('input', function(evt) {
				console.log('Slide value: ' + slider.value);
				sliderValue.innerText = 'Slider value: ' + slider.value;

				var speed = Math.abs(slider.value)/40+0.5;

		  	bufferPlayer.playbackRate.value = speed;
		  	sprite.set('fps', speed*14);
			})
		}
	</script>
</body>
</html>
